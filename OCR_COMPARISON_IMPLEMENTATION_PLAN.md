# OCRæ¯”è¼ƒæ¤œè¨¼æ©Ÿèƒ½ - æ–°ç³»ç§»æ¤å®Ÿè£…è¨ˆç”»

## ğŸ“‹ æ—§ç³»æ©Ÿèƒ½åˆ†æçµæœ

### æ—¢å­˜æ©Ÿèƒ½æ¦‚è¦
**æ—§ç³» (`OLD/app/routes/try_ocr.py` + `try_ocr.html`)**
- âœ… è¤‡æ•°OCRã‚¨ãƒ³ã‚¸ãƒ³æ¯”è¼ƒ (OCRMyPDF, Tesseractç­‰)
- âœ… ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ â†’ ä¸€æ™‚å‡¦ç†
- âœ… å˜ä¸€ãƒšãƒ¼ã‚¸/å…¨ãƒšãƒ¼ã‚¸å‡¦ç†å¯¾å¿œ
- âœ… èª¤å­—ä¿®æ­£è¾æ›¸æ©Ÿèƒ½ (CSVè¾æ›¸ä½¿ç”¨)
- âœ… å…¨è§’â†’åŠè§’å¤‰æ›çµ±åˆå‡¦ç†
- âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ PDFè¡¨ç¤º
- âœ… HTMLç½®æ›çµæœãƒã‚¤ãƒ©ã‚¤ãƒˆ
- âœ… ã‚¨ãƒ³ã‚¸ãƒ³ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´UI

### ä¸»è¦APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- `GET /try_ocr` - OCRæ¯”è¼ƒãƒšãƒ¼ã‚¸è¡¨ç¤º
- `POST /api/try_ocr/process` - OCRå‡¦ç†å®Ÿè¡Œ
- `GET /api/try_ocr/engines` - åˆ©ç”¨å¯èƒ½ã‚¨ãƒ³ã‚¸ãƒ³ä¸€è¦§
- `GET /api/try_ocr/engine_parameters/{engine_name}` - ã‚¨ãƒ³ã‚¸ãƒ³ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

## ğŸ¯ æ–°ç³»ç§»æ¤æ–¹é‡

### è¦ä»¶
1. **DBå†…ãƒ•ã‚¡ã‚¤ãƒ«ä½¿ç”¨**: `files_blob`ã‹ã‚‰ç›´æ¥é¸æŠ (ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸è¦)
2. **n=1é¸æŠ**: ãƒ‡ãƒ¼ã‚¿ç™»éŒ²å³ãƒšã‚¤ãƒ³ã®ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠUIã‚’æµç”¨
3. **è¤‡æ•°ã‚¨ãƒ³ã‚¸ãƒ³æ¯”è¼ƒ**: æ—§ç³»ã¨åŒç­‰ã®æ¯”è¼ƒæ©Ÿèƒ½
4. **UIçµ±åˆ**: æ–°ç³»ãƒ‡ã‚¶ã‚¤ãƒ³ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³æº–æ‹ 

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

```
new/
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ ocr_comparison.html         # æ–°ãƒšãƒ¼ã‚¸
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ ocr_comparison.css      # å°‚ç”¨CSS
â”‚   â””â”€â”€ js/
â”‚       â”œâ”€â”€ ocr_comparison.js       # ãƒ¡ã‚¤ãƒ³æ©Ÿèƒ½
â”‚       â”œâ”€â”€ ocr_file_selector.js    # ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠï¼ˆãƒ‡ãƒ¼ã‚¿ç™»éŒ²æµç”¨ï¼‰
â”‚       â””â”€â”€ ocr_results_display.js  # çµæœè¡¨ç¤º
â”œâ”€â”€ api/
â”‚   â””â”€â”€ ocr_comparison.py           # OCRæ¯”è¼ƒAPI
â””â”€â”€ services/
    â””â”€â”€ ocr_comparison/
        â”œâ”€â”€ __init__.py
        â”œâ”€â”€ comparison_engine.py    # æ¯”è¼ƒå‡¦ç†ã‚¨ãƒ³ã‚¸ãƒ³
        â””â”€â”€ correction_service.py   # èª¤å­—ä¿®æ­£ã‚µãƒ¼ãƒ“ã‚¹
```

## ğŸ”„ å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º

### ãƒ•ã‚§ãƒ¼ã‚º1: åŸºç›¤å®Ÿè£…
- [ ] `ocr_comparison.py` APIå®Ÿè£…
- [ ] `ocr_comparison.html` ãƒšãƒ¼ã‚¸ä½œæˆ
- [ ] ãƒ‡ãƒ¼ã‚¿ç™»éŒ²å³ãƒšã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠæ©Ÿèƒ½æµç”¨

### ãƒ•ã‚§ãƒ¼ã‚º2: OCRæ¯”è¼ƒã‚¨ãƒ³ã‚¸ãƒ³
- [ ] `comparison_engine.py` - è¤‡æ•°ã‚¨ãƒ³ã‚¸ãƒ³ä¸¦åˆ—å‡¦ç†
- [ ] `correction_service.py` - èª¤å­—ä¿®æ­£ãƒ»æ­£è¦åŒ–å‡¦ç†
- [ ] çµæœæ¯”è¼ƒãƒ»çµ±è¨ˆè¡¨ç¤ºæ©Ÿèƒ½

### ãƒ•ã‚§ãƒ¼ã‚º3: UI/UXçµ±åˆ
- [ ] `ocr_comparison.css` - æ–°ç³»ãƒ‡ã‚¶ã‚¤ãƒ³çµ±åˆ
- [ ] `ocr_file_selector.js` - ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠUI (n=1å¯¾å¿œ)
- [ ] `ocr_results_display.js` - çµæœè¡¨ç¤ºãƒ»ãƒã‚¤ãƒ©ã‚¤ãƒˆ

### ãƒ•ã‚§ãƒ¼ã‚º4: æ¤œè¨¼ãƒ»æœ€é©åŒ–
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆ
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–

## ğŸ¨ UIè¨­è¨ˆæ–¹é‡

### ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“„ OCRæ¯”è¼ƒæ¤œè¨¼                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å·¦ãƒšã‚¤ãƒ³         â”‚ å³ãƒšã‚¤ãƒ³                   â”‚
â”‚                â”‚                        â”‚
â”‚ ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ      â”‚ OCRè¨­å®š                  â”‚
â”‚ ãƒ»DBå†…ãƒ•ã‚¡ã‚¤ãƒ«    â”‚ ãƒ»ã‚¨ãƒ³ã‚¸ãƒ³é¸æŠ             â”‚
â”‚ ãƒ»n=1é¸æŠ       â”‚ ãƒ»ãƒšãƒ¼ã‚¸æŒ‡å®š              â”‚
â”‚ ãƒ»ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼      â”‚ ãƒ»èª¤å­—ä¿®æ­£ON/OFF          â”‚
â”‚                â”‚ ãƒ»æ¯”è¼ƒå®Ÿè¡Œãƒœã‚¿ãƒ³           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä¸‹ãƒšã‚¤ãƒ³: æ¯”è¼ƒçµæœè¡¨ç¤º                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚ â”‚OCRMyPDFâ”‚Tesseractâ”‚Customâ”‚çµ±è¨ˆ  â”‚      â”‚
â”‚ â”‚çµæœ     â”‚çµæœ      â”‚çµæœ   â”‚æ¯”è¼ƒ  â”‚      â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ‡ãƒ¼ã‚¿ç™»éŒ²å³ãƒšã‚¤ãƒ³æµç”¨ãƒã‚¤ãƒ³ãƒˆ
- `FileSelectionManager` ã‚¯ãƒ©ã‚¹æ´»ç”¨
- `maxSelection: 1` ã§å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠåˆ¶é™
- æ—¢å­˜ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»æ¤œç´¢æ©Ÿèƒ½ãã®ã¾ã¾åˆ©ç”¨
- `files_blob` ãƒ†ãƒ¼ãƒ–ãƒ«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹

## ğŸ“¡ APIè¨­è¨ˆ

### `/api/ocr-comparison/process`
```json
{
  "file_id": "uuid-string",
  "engines": ["ocrmypdf", "tesseract", "custom"],
  "page_num": 1,
  "use_correction": true,
  "correction_settings": {
    "enable_typo_fix": true,
    "enable_normalization": true
  }
}
```

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹
```json
{
  "file_info": {
    "id": "uuid",
    "name": "document.pdf",
    "size": 1024000
  },
  "results": {
    "ocrmypdf": {
      "success": true,
      "text": "å‡¦ç†çµæœãƒ†ã‚­ã‚¹ãƒˆ",
      "processing_time": 2.5,
      "confidence": 0.95,
      "corrections": [...]
    },
    "tesseract": {...},
    "custom": {...}
  },
  "comparison": {
    "similarity_matrix": {...},
    "best_engine": "ocrmypdf",
    "statistics": {...}
  }
}
```

## ğŸ”§ æŠ€è¡“è©³ç´°

### ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠæ©Ÿèƒ½æµç”¨
```javascript
// ocr_file_selector.js
class OCRFileSelector extends FileSelectionManager {
    constructor() {
        super();
        this.maxSelection = 1; // n=1åˆ¶é™
        this.allowedTypes = ['.pdf', '.png', '.jpg', '.jpeg'];
    }
    
    onFileSelected(fileId) {
        // OCRæ¯”è¼ƒãƒšãƒ¼ã‚¸ç”¨ã®å‡¦ç†
        this.loadFilePreview(fileId);
        this.enableComparisonPanel();
    }
}
```

### OCRæ¯”è¼ƒã‚¨ãƒ³ã‚¸ãƒ³çµ±åˆ
```python
# services/ocr_comparison/comparison_engine.py
class OCRComparisonEngine:
    def __init__(self):
        self.ocr_factory = OCREngineFactory()
        self.correction_service = CorrectionService()
    
    async def compare_engines(self, file_path: str, engines: List[str], settings: Dict) -> Dict:
        results = {}
        for engine in engines:
            result = await self.process_with_engine(engine, file_path, settings)
            results[engine] = result
        
        return {
            'results': results,
            'comparison': self.generate_comparison(results)
        }
```

## ğŸ“ å®Ÿè£…å„ªå…ˆåº¦

1. **High**: APIåŸºç›¤ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠæ©Ÿèƒ½æµç”¨
2. **Medium**: OCRæ¯”è¼ƒã‚¨ãƒ³ã‚¸ãƒ³ãƒ»çµæœè¡¨ç¤º
3. **Low**: èª¤å­—ä¿®æ­£çµ±åˆãƒ»é«˜åº¦ãªçµ±è¨ˆæ©Ÿèƒ½

ã“ã®è¨ˆç”»ã«åŸºã¥ã„ã¦ã€æ®µéšçš„ã«OCRæ¯”è¼ƒæ¤œè¨¼æ©Ÿèƒ½ã‚’æ–°ç³»ã«ç§»æ¤å®Ÿè£…ã—ã¾ã™ã€‚