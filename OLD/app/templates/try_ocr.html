<!-- app/templates/try_ocr.html @リファクタリング完了: 2025-07-26 -->
{% extends "base.html" %}

{% block head %}
<!-- PDF.jsライブラリの読み込み -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
  // PDF.jsの設定
  if (typeof pdfjsLib !== 'undefined') {
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
  }
</script>
<!-- 共通CSSファイル -->
<link rel="stylesheet" href="{{ url_for('static', path='css/common.css') }}">
<!-- 専用CSSファイル -->
<link rel="stylesheet" href="{{ url_for('static', path='css/try_ocr.css') }}">
{% endblock %}

{% block content %}
<div id="try-ocr-container">
  <!-- 上ペイン：2分割設定 -->
  <div id="pane-top">
    <!-- 左上ペイン：基本設定（ファイル選択含む） -->
    <div id="top-left">
      <h1 class="section-title">⚙️ 基本設定</h1>
      <div class="form-section">
        <label for="file-input">ファイル指定:</label>
        <input type="text" id="file-input" readonly placeholder="ファイルを選択してください">
        <button type="button" id="browse-file">📂</button>
      </div>
      <input type="file" id="file-picker" style="display:none;" accept=".pdf,.png,.jpg,.jpeg">
      
      <div class="form-section">
        <label for="engine-select">OCRエンジン:</label>
        <select id="engine-select" style="width:250px;">
          {% for engine in engines %}
          <option value="{{ engine }}">{{ engine }}</option>
          {% endfor %}
        </select>
      </div>
      
      <div class="form-section">
        <label for="page-num">ページ番号:</label>
        <input type="number" id="page-num" value="1" min="0" step="1">
        <span style="margin-left:0.5em; color:#666; font-size:0.8em;">(0は全ページ)</span>
      </div>
      
      <div class="form-section">
        <label>PDF表示:</label>
        <label style="margin-left:0.5em;"><input type="radio" name="pdf_mode" value="embed" checked> 表示</label>
        <label style="margin-left:0.5em;"><input type="radio" name="pdf_mode" value="hide"> 非表示</label>
      </div>
      
      <div class="form-actions">
        <button id="process-btn" class="btn btn-primary">🚀 OCR実行</button>
        <button id="cancel-btn" class="btn btn-cancel" disabled>✖️ キャンセル</button>
        <label>
          <input type="checkbox" id="use-correction-dict" checked> 誤字修正
        </label>
        <button id="clear-btn" class="btn">🗑️ 結果クリア</button>
        <button id="compare-all-btn" class="btn">📊 全エンジン比較</button>
      </div>
    </div>

    <!-- 上ペイン用スプリッター -->
    <div id="top-splitter"></div>

    <!-- 右上ペイン：エンジン調整 -->
    <div id="top-right">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
        <h1 class="section-title">🔧 エンジン調整</h1>
        <div class="form-actions" style="margin: 0;">
          <button id="ocr-settings-btn" class="btn">設定</button>
        </div>
      </div>
      <div id="engine-parameters">
        <p style="color:#888; font-size:0.9em;">OCRエンジンを選択すると、調整項目が表示されます</p>
      </div>
    </div>
  </div>

  <!-- 上下分割用スプリッター -->
  <div id="vertical-splitter"></div>

  <!-- 下ペイン：結果とPDF -->
  <div id="pane-bottom">
    <div id="results-pane">
      <!-- 処理ステータス（最上位のみ） -->
      <div id="processing-status" style="display: none;">
        <div class="status-message">待機中</div>
        <div class="status-timer"></div>
      </div>
      
      <!-- OCR結果表示エリア -->
      <div id="results-container">
        <!-- 初期メッセージはJavaScriptで動的に設定 -->
      </div>
    </div>

    <!-- スプリッター -->
    <div id="splitter"></div>

    <!-- PDF表示ペイン -->
    <div id="pdf-pane">
      <iframe id="pdf-viewer" style="width:100%; height:100%; border:none;"></iframe>
    </div>
  </div>
</div>

<!-- 処理中オーバーレイ -->
<div id="processing-overlay">
  <div class="spinner"></div>
  <div id="processing-message">OCR処理中…</div>
</div>

<!-- 機能別JavaScriptファイル -->
<script src="{{ url_for('static', path='js/ocr_settings_dialog.js') }}"></script>
<script src="{{ url_for('static', path='js/try_ocr_pdf.js') }}"></script>
<script src="{{ url_for('static', path='js/try_ocr_engine.js') }}"></script>
<script src="{{ url_for('static', path='js/try_ocr_ui.js') }}"></script>
<script src="{{ url_for('static', path='js/try_ocr_resize.js') }}"></script>
<script src="{{ url_for('static', path='js/try_ocr_main.js') }}"></script>
{% endblock %}