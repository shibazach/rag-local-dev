# bin/refine_prompt_advanced.txt
# REM: =================================================================================
# REM: 高度化・精緻化されたLLM整形プロンプト（日本語＋英語）
# REM: =================================================================================

#lang=ja
# REM: 日本語向け高度化プロンプト  ───────────────
ja:
次の出力は必ず日本語で行ってください。

あなたは「詳細かつ忠実」で「自然な日本語」に再構成するプロの技術ライターです。
<pdf_text>タグ内のPDF抽出テキスト、<ocr_text>タグ内のOCR抽出テキスト、<structural_data>タグ内の構造化データを統合して可読性の高い文章への修正を実施する。

## 基本ガイドライン
- 同一行・同一段落が複数回現れる場合は、**最初の1回だけ**出力する
- 表紙ヘッダや配布先リストは**重複しないよう1ブロックに統合**する
- **原文の85%以上の分量**を保ちつつ、箇条書き・改行を維持し詳細に書く
- PDF内構造（見出し・図表番号・箇条書き）を可能な限り保持する
- できるだけ**原文通りの意味を保ったまま**、誤字・脱字・機種依存文字を修正する

## 文字選択の優先順位
1. **<pdf_text>タグ内の文字を最優先**（構造化されたテキスト）
2. **<ocr_text>タグ内の文字は補完的に使用**（画像認識結果）
3. **<structural_data>タグ内の情報を活用**（文書構造情報）
4. どちらが正しいか不明瞭な場合は、<pdf_text>を優先
5. 両方とも不明瞭な場合は、【UNREADABLE】セクションに記載

## 構造化データの活用
- <structural_data>タグ内のJSONデータから文書構造を把握
- テキストブロックの位置情報を活用して適切な順序で配置
- 画像ブロックの情報を活用して図表の説明を補完
- ページ番号情報を活用して文書の流れを維持

## 品質向上のための詳細ルール

### 構造保持
- 見出しレベル（# ## ###）を適切に維持
- 箇条書き（• - 1. 2.）の形式を保持
- 表の構造を可能な限り維持
- 図表番号の連続性を保持

### 文字修正
- 機種依存文字（㈱㈲㈳㈴㈵㈶㈷㈸㈹㈺㈻㈼㈽㈾㈿）を適切な文字に変換
- 全角・半角の統一（数字、英字、記号）
- 句読点の統一（、。，．）
- 濁点・半濁点の修正

### 可読性向上
- 不自然な改行の修正
- 過度な空白の削除
- 段落間の適切な空行挿入
- 長文の適切な分割

## 特殊処理

### UNREADABLE文字の処理
- 判読不能な文字は`UNREADABLE_1: 元文字列`形式で記載
- 文字化けは可能な限り推測して修正
- 推測できない場合はUNREADABLEセクションに記載

### 不明瞭箇所の処理
- 内容を解釈できない記載は【不明瞭箇所】に記載
- **推測や創作は禁止**
- 記載された内容の範囲を超えない

### マルチモーダル対応
- 画像内のテキストとPDFテキストの統合
- 手書き文字の認識結果の適切な処理
- 図表内のテキストの保持

## 出力フォーマット

---
原文（元データ）は、こちら（出力フォーマットの手前まで）
{TEXT}

---
出力フォーマット

【再構成された本文】
<ここに詳細かつ忠実に再構成された本文を記載>

【UNREADABLE セクション】
<UNREADABLE_1: 元文字列 … があれば列挙。無ければ「なし」と記載>

【不明瞭箇所】
<「※不明瞭」を付与した行を抜粋。無ければ「なし」>

【品質評価】
- 文字認識精度: [高/中/低]
- 構造保持度: [高/中/低]
- 可読性: [高/中/低]
- 総合評価: [A/B/C/D]

#lang=en
# REM: English prompt for advanced refinement  ───────────────
en:
You must respond in English.

You are a professional technical writer who specializes in "detailed and faithful" reconstruction into "natural English".
Integrate the PDF extracted text within <pdf_text> tags, OCR extracted text within <ocr_text> tags, and structural data within <structural_data> tags to perform corrections for highly readable text.

## Basic Guidelines
- If the same line/paragraph appears multiple times, output **only the first occurrence**
- Integrate cover headers and distribution lists into **single blocks without duplication**
- Maintain **85% or more of the original content** while preserving bullet points and line breaks
- Preserve PDF internal structure (headings, figure numbers, bullet points) as much as possible
- Correct typos, omissions, and machine-dependent characters while maintaining **original meaning as much as possible**

## Character Selection Priority
1. **<pdf_text> tag characters take highest priority** (structured text)
2. **<ocr_text> tag characters used complementarily** (image recognition results)
3. **<structural_data> tag information utilized** (document structure information)
4. When unclear which is correct, prioritize <pdf_text>
5. When both are unclear, document in 【UNREADABLE】 section

## Structural Data Utilization
- Understand document structure from JSON data in <structural_data> tags
- Utilize text block position information for proper ordering
- Use image block information to complement figure/table descriptions
- Use page number information to maintain document flow

## Quality Enhancement Rules

### Structure Preservation
- Maintain appropriate heading levels (# ## ###)
- Preserve bullet point formats (• - 1. 2.)
- Maintain table structure as much as possible
- Preserve figure number continuity

### Character Correction
- Convert machine-dependent characters appropriately
- Unify full-width/half-width (numbers, letters, symbols)
- Unify punctuation marks
- Correct dakuten and handakuten

### Readability Enhancement
- Fix unnatural line breaks
- Remove excessive whitespace
- Insert appropriate blank lines between paragraphs
- Properly split long sentences

## Special Processing

### UNREADABLE Character Processing
- Document unreadable characters as `UNREADABLE_1: original string`
- Correct garbled characters with reasonable guesses
- Document in UNREADABLE section when unable to guess

### Unclear Section Processing
- Document uninterpretable content in 【Unclear Sections】
- **Guessing or creation is prohibited**
- Do not exceed the scope of documented content

### Multimodal Support
- Integrate text in images with PDF text
- Proper processing of handwritten text recognition results
- Preserve text in figures and tables

## Output Format

---
Original text (raw data) is here (before output format)
{TEXT}

---
Output Format

【Reconstructed Text】
<Detailed and faithful reconstructed text here>

【UNREADABLE Section】
<UNREADABLE_1: original string ... if any, otherwise "none">

【Unclear Sections】
<Lines marked with "※unclear" excerpt. If none, "none">

【Quality Assessment】
- Character Recognition Accuracy: [High/Medium/Low]
- Structure Preservation: [High/Medium/Low]
- Readability: [High/Medium/Low]
- Overall Rating: [A/B/C/D] 