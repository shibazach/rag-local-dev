<!-- app/templates/base.html @2025-07-18 00:00 UTC +9 -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ç ”ç©¶éƒ¨RAG</title>
  <link rel="stylesheet" href="/static/styles.css">
  <style>
    /* REM: å…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    body {
      margin: 0;
      display: flex;
      height: 100vh;
      font-family: sans-serif;
    }
    /* REM: ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
    nav {
      width: 200px;
      background: #f4f4f4;
      border-right: 1px solid #ddd;
      padding: 1em;
      box-sizing: border-box;
    }
    nav h2 {
      margin-top: 0;
      font-size: 1.2em;
    }
    nav ul {
      list-style: none;
      padding: 0;
    }
    nav li + li {
      margin-top: 0.5em;
    }
    nav a {
      text-decoration: none;
      color: #333;
    }
    nav a:hover {
      text-decoration: underline;
    }
    /* REM: ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
    main {
      flex: 1;
      padding: 1em;
      overflow: auto;
    }
    /* REM: ãƒšãƒ¼ã‚¸ã”ã¨ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚¹ã‚¿ã‚¤ãƒ« */
    .page-title {
      margin: 0 0 8px;
      font-size: 1.2em;
      line-height: 1.5em;
    }
    .index-title {
      margin: 0 0 8px;
      line-height: 1.5em;
    }
  </style>
  <!-- REM: ãƒšãƒ¼ã‚¸å›ºæœ‰ã® head è¦ç´ ã‚’ã“ã“ã«è¿½åŠ  -->
  {% block head %}{% endblock %}
</head>
<body>
  <nav>
    <!-- REM: ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚¿ã‚¤ãƒˆãƒ« -->
    <h2>ğŸ§  ç ”ç©¶éƒ¨RAG</h2>
    <ul>
      <li><a href="/ingest">âœï¸ ãƒ‡ãƒ¼ã‚¿æ•´å½¢/ç™»éŒ²</a></li>
      <li><a href="/chat">ğŸ” ãƒãƒ£ãƒƒãƒˆæ¤œç´¢</a></li>
    </ul>
    <hr>
    <!-- REM: ã‚·ã‚¹ãƒ†ãƒ ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°è¡¨ç¤ºç”¨ -->
    <div id="system-monitor">
      <p>CPU ä½¿ç”¨ç‡ï¼š<span id="cpu-usage">--</span>%</p>
      <p id="gpu-info" style="display:none">
        GPU ä½¿ç”¨ç‡ï¼š<span id="gpu-util">--</span>%<br>
        æ¶ˆè²»é›»åŠ›ï¼š<span id="gpu-power">--</span>W
      </p>
    </div>
  </nav>

  <!-- REM: ã‚·ã‚¹ãƒ†ãƒ ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
  <script>
    setInterval(async () => {
      try {
        const res = await fetch('/metrics');
        if (!res.ok) return;
        const j = await res.json();
        // REM: j.cpu ãŒæœªå®šç¾©ã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
        if (!j || typeof j.cpu !== 'number') return;
        document.getElementById('cpu-usage').textContent = j.cpu.toFixed(1);
        // REM: GPU æƒ…å ±ãŒã‚ã‚‹å ´åˆã®ã¿è¡¨ç¤º
        if (j.gpu && typeof j.gpu.util === 'number') {
          document.getElementById('gpu-info').style.display = 'block';
          document.getElementById('gpu-util').textContent = j.gpu.util.toFixed(1);
          // REM: GPU power ãŒæ•°å€¤ãªã‚‰è¡¨ç¤º
          if (typeof j.gpu.power === 'number') {
            document.getElementById('gpu-power').textContent = j.gpu.power.toFixed(1);
          }
        }
      } catch (e) {
        console.error('metrics fetch error:', e);
      }
    }, 3000);
  </script>

  <main>
    {% block content %}{% endblock %}
  </main>
</body>
</html>
