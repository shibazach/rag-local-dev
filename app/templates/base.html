<!-- app/templates/base.html @2025-07-18 00:00 UTC +9 -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>研究部RAG</title>
  <link rel="stylesheet" href="/static/styles.css">
  <style>
    /* REM: 全体レイアウト */
    body {
      margin: 0;
      display: flex;
      height: 100vh;
      font-family: sans-serif;
    }
    /* REM: ナビゲーション */
    nav {
      width: 200px;
      background: #f4f4f4;
      border-right: 1px solid #ddd;
      padding: 1em;
      box-sizing: border-box;
    }
    nav h2 {
      margin-top: 0;
      font-size: 1.2em;
    }
    nav ul {
      list-style: none;
      padding: 0;
    }
    nav li + li {
      margin-top: 0.5em;
    }
    nav a {
      text-decoration: none;
      color: #333;
    }
    nav a:hover {
      text-decoration: underline;
    }
    /* REM: メインコンテンツ */
    main {
      flex: 1;
      padding: 1em;
      overflow: auto;
    }
    /* REM: ページごとのタイトルスタイル */
    .page-title {
      margin: 0 0 8px;
      font-size: 1.2em;
      line-height: 1.5em;
    }
    .index-title {
      margin: 0 0 8px;
      line-height: 1.5em;
    }
  </style>
  <!-- REM: ページ固有の head 要素をここに追加 -->
  {% block head %}{% endblock %}
</head>
<body>
  <nav>
    <!-- REM: サイドバータイトル -->
    <h2>🧠 研究部RAG</h2>
    <ul>
      <li><a href="/ingest">✏️ データ整形/登録</a></li>
      <li><a href="/chat">🔍 チャット検索</a></li>
    </ul>
    <hr>
    <!-- REM: システムモニタリング表示用 -->
    <div id="system-monitor">
      <p>CPU 使用率：<span id="cpu-usage">--</span>%</p>
      <p id="gpu-info" style="display:none">
        GPU 使用率：<span id="gpu-util">--</span>%<br>
        消費電力：<span id="gpu-power">--</span>W
      </p>
    </div>
  </nav>

  <!-- REM: システムモニタリング用スクリプト -->
  <script>
    setInterval(async () => {
      try {
        const res = await fetch('/metrics');
        if (!res.ok) return;
        const j = await res.json();
        // REM: j.cpu が未定義の場合はスキップ
        if (!j || typeof j.cpu !== 'number') return;
        document.getElementById('cpu-usage').textContent = j.cpu.toFixed(1);
        // REM: GPU 情報がある場合のみ表示
        if (j.gpu && typeof j.gpu.util === 'number') {
          document.getElementById('gpu-info').style.display = 'block';
          document.getElementById('gpu-util').textContent = j.gpu.util.toFixed(1);
          // REM: GPU power が数値なら表示
          if (typeof j.gpu.power === 'number') {
            document.getElementById('gpu-power').textContent = j.gpu.power.toFixed(1);
          }
        }
      } catch (e) {
        console.error('metrics fetch error:', e);
      }
    }, 3000);
  </script>

  <main>
    {% block content %}{% endblock %}
  </main>
</body>
</html>
