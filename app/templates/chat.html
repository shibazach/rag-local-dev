<!-- app/templates/chat.html  # REM: æœ€çµ‚æ›´æ–° 2025-07-10 12:59 -->
{% extends "base.html" %}

{% block head %}
  <!-- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚¤ãƒ‘ã‚¹ç”¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¯ã‚¨ãƒª -->
  <link rel="stylesheet" href="/static/styles.css?v=20250710_1149">
  <script src="/static/js/chat.js?v=20250710_1149" defer></script>

  <style>
    /* â”€â”€â”€â”€â”€ chatå°‚ç”¨ï¼šmainã®ä¸Šä½™ç™½ã®ã¿æ¶ˆã—ã¦ã€å·¦å³ã¯1emã®ã¾ã¾ä¿æŒ */
    main {
      /* ä¸Šã ã‘ 0 ã«ã—ã¦é«˜ã•ã‚’æƒãˆã‚‹ */
      padding-top: 0 !important;
      /* å·¦ã®1emã¯å…ƒã®ã¾ã¾æ®‹ã™ï¼ˆãƒ‡ãƒ¼ã‚¿æ•´å½¢ãƒšãƒ¼ã‚¸ã¨åŒä½ç½®ï¼‰ */
      /* padding-left: 1em; â† base.html ç”±æ¥ãªã®ã§ä¸Šæ›¸ãä¸è¦ */
    }
    /* #controlsï¼šä¸Š1emãƒ»å³8pxãƒ»ä¸‹4pxãƒ»å·¦0 ã§ã€main ã® 1em ãŒåŠ¹ãã‚ˆã†ã« */
    #controls {
      position: sticky;
      top: 0;
      margin: 0;
      padding: 1em 8px 4px 0;
      background: #fff;
      border-bottom: 1px solid #ddd;
      z-index: 100;
    }
    #controls h1.chat-title {
      margin: 0 0 8px;
      font-size: 1.2em;
      line-height: 1.5em;
    }

    /* å…¨ä½“ã®ä½™ç™½ãƒªã‚»ãƒƒãƒˆ */
    html, body {
      margin: 0;
      background: #fff;
    }

    /* è³ªå•å…¥åŠ› */
    #query {
      width: 100%;
      box-sizing: border-box;
      resize: vertical;
    }

    /* çµ±åˆå›ç­”ã‚¨ãƒªã‚¢ */
    #answer {
      display: none;
      margin: 12px 0;
      padding: 8px 12px;
      border: 1px solid #888;
      border-radius: 4px;
      background: #eef;
    }
    #answer h2 {
      margin: 0 0 8px;
      font-size: 1.2em;
    }
    #answer pre {
      margin: 0;
      white-space: pre-wrap;
    }

    /* çµæœã‚«ãƒ¼ãƒ‰ */
    .card {
      border: 1px solid #ddd;
      padding: 12px;
      margin: 8px 0;
      border-radius: 4px;
      background: #fafafa;
    }
    .card h3 {
      margin: 0 0 6px;
      font-size: 1.1em;
    }
    .card pre {
      white-space: pre-wrap;
      background: #f5f5f5;
      padding: 8px;
      border-radius: 4px;
      overflow-x: auto;
    }
    .card button {
      margin-top: 6px;
      padding: 4px 8px;
    }

    /* ç·¨é›†ãƒœãƒƒã‚¯ã‚¹ */
    .editor textarea {
      width: 100%;
      box-sizing: border-box;
      resize: vertical;
      height: 200px;
    }
    .editor button {
      margin-right: 8px;
    }

    /* å†ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
    #processing-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.6);
      color: #fff;
      z-index: 10000;
      font-size: 1.4em;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }
    #processing-overlay button {
      margin-top: 1em;
      padding: 0.5em 1em;
      font-size: 1em;
    }

    /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ†ã‚­ã‚¹ãƒˆ */
    #loading {
      display: none;
      color: #555;
      margin-left: 8px;
    }
  </style>
{% endblock %}

{% block content %}
  <div id="controls">
    <h1 class="chat-title">ğŸ” ãƒãƒ£ãƒƒãƒˆæ¤œç´¢</h1>

    <textarea id="query" rows="4" placeholder="è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„â€¦"></textarea><br><br>

    <label for="mode">æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰:</label>
    <select id="mode">
      <option value="ãƒãƒ£ãƒ³ã‚¯çµ±åˆ">ãƒãƒ£ãƒ³ã‚¯çµ±åˆ</option>
      <option value="ãƒ•ã‚¡ã‚¤ãƒ«åˆ¥ï¼ˆè¦ç´„+ä¸€è‡´åº¦ï¼‰">ãƒ•ã‚¡ã‚¤ãƒ«åˆ¥ï¼ˆè¦ç´„+ä¸€è‡´åº¦ï¼‰</option>
    </select>
    &ensp;
    <label for="model_key">åŸ‹ã‚è¾¼ã¿ãƒ¢ãƒ‡ãƒ«:</label>
    <select id="model_key">
      {% for key, config in embedding_options.items() %}
        <option value="{{ key }}">{{ config["model_name"] }} ({{ config["embedder"] }})</option>
      {% endfor %}
    </select>
    <br><br>
    <button id="search-btn">ğŸ” æ¤œç´¢å®Ÿè¡Œ</button>
    <button id="cancel-btn" disabled>âœ–ï¸ ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    <span id="loading">æ¤œç´¢ä¸­â€¦ãŠå¾…ã¡ãã ã•ã„</span>
    <div id="pane-bottom"></div><br>
  </div>
  
  <div id="answer"></div>
  <div id="results"></div>

  <div id="processing-overlay">
    <div id="overlay-message">å†ãƒ™ã‚¯ãƒˆãƒ«åŒ–ä¸­â€¦<br>é–‰ã˜ãªã„ã§ãã ã•ã„</div>
    <button id="overlay-ok-btn" style="display:none;">OK</button>
  </div>
{% endblock %}
