<!-- app/templates/chat.html @2025-07-18 00:00 UTC +9 -->
{% extends "base.html" %}

{% block head %}
  <!-- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚¤ãƒ‘ã‚¹ç”¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¯ã‚¨ãƒª -->
  <link rel="stylesheet" href="/static/styles.css?v=20250710_1149">
  <script src="/static/js/chat.js?v=20250710_1149" defer></script>

  <style>
    /* ãƒšã‚¤ãƒ³ä¸Šä¸‹åˆ†å‰²ï¼ˆingestã¨åŒæ§˜ï¼‰ */
    #chat-container { display:flex; flex-direction:column; height:calc(100vh - 2em); }

    /* ä¸Šãƒšã‚¤ãƒ³ï¼šæ¤œç´¢ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
    #pane-top {
      flex:0 0 auto;
      padding:1em;
      border-bottom:1px solid #ddd;
      box-sizing:border-box;
    }

    /* ä¸‹ãƒšã‚¤ãƒ³ï¼šçµæœã¨å³ãƒšã‚¤ãƒ³ã‚’å·¦å³ä¸¦ã³ã« */
    #pane-bottom {
      flex:1 1 auto;
      display:flex;
      overflow:hidden;
    }
    /* å·¦ã‚«ãƒ©ãƒ ï¼šæ¤œç´¢çµæœ */
    #results-pane {
      flex:1 1 auto;
      overflow-y:auto;
      padding:1em;
      background:#fafafa;
      box-sizing:border-box;
    }

    /* REM: ãƒšã‚¤ãƒ³é–“ã‚¹ãƒ—ãƒªãƒƒã‚¿ãƒ¼ */
    #splitter {
      flex: 0 0 5px;
      cursor: col-resize;
      background: #ccc;
    }

    /* å³ã‚«ãƒ©ãƒ ï¼šPDFè¡¨ç¤º/ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç·¨é›†ã‚¨ãƒªã‚¢ */
    #right-pane {
      flex:0 0 40%;
      display:none;
      border-left:1px solid #ccc;
      box-sizing:border-box;
      overflow:hidden;
    }

    /* å…¨ä½“ã®ä½™ç™½ãƒªã‚»ãƒƒãƒˆ */
    html, body {
      margin: 0;
      background: #fff;
    }
    main {
      padding: 0 !important;
    }

    /* å…¨ä½“ã®ä½™ç™½ãƒªã‚»ãƒƒãƒˆ */
    html, body {
      margin: 0;
      background: #fff;
    }

    /* è³ªå•å…¥åŠ› */
    #query {
      width: 100%;
      box-sizing: border-box;
      resize: vertical;
    }

    /* çµ±åˆå›ç­”ã‚¨ãƒªã‚¢ */
    #answer {
      display: none;
      margin: 12px 0;
      padding: 8px 12px;
      border: 1px solid #888;
      border-radius: 4px;
      background: #eef;
    }
    #answer h2 {
      margin: 0 0 8px;
      font-size: 1.2em;
    }
    #answer pre {
      margin: 0;
      white-space: pre-wrap;
    }

    /* çµæœã‚«ãƒ¼ãƒ‰ */
    .card {
      border: 1px solid #ddd;
      padding: 12px;
      margin: 8px 0;
      border-radius: 4px;
      background: #fafafa;
    }
    .card h3 {
      margin: 0 0 6px;
      font-size: 1.1em;
    }
    .card pre {
      white-space: pre-wrap;
      background: #f5f5f5;
      padding: 8px;
      border-radius: 4px;
      overflow-x: auto;
    }
    .card button {
      margin-top: 6px;
      padding: 4px 8px;
    }

    /* ç·¨é›†ãƒœãƒƒã‚¯ã‚¹ */
    .editor textarea {
      width: 100%;
      box-sizing: border-box;
      resize: vertical;
      height: 200px;
    }
    .editor button {
      margin-right: 8px;
    }

    /* å†ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
    #processing-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.6);
      color: #fff;
      z-index: 10000;
      font-size: 1.4em;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }
    #processing-overlay button {
      margin-top: 1em;
      padding: 0.5em 1em;
      font-size: 1em;
    }

    /* æ¤œç´¢ä¸­ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
    #search-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.5);
      color: #fff;
      z-index: 9999;
      font-size: 1.2em;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }
    #search-overlay .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin-bottom: 1em;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* ãƒ•ã‚©ãƒ¼ãƒ  */
    .form-section {
      display:flex; align-items:center;
      margin-bottom:0.1em; line-height:1.2; width:100%;
    }
    .form-actions { margin-top:1em; }
    .form-actions button { margin-right:1em; }

    /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ†ã‚­ã‚¹ãƒˆ */
    #loading {
      display: none;
      color: #555;
      margin-left: 8px;
    }
  </style>
{% endblock %}

{% block content %}
<div id="chat-container">
  <!-- ä¸Šãƒšã‚¤ãƒ³ï¼šæ¤œç´¢ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
  <div id="pane-top">
    <h1 class="page-title">ğŸ” ãƒãƒ£ãƒƒãƒˆæ¤œç´¢</h1>

    <div class="form-section">
      <textarea id="query" rows="4" placeholder="è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„â€¦"></textarea>
    </div>
    <div class="form-section">
      <label for="mode">æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰ï¼š</label>
      <select id="mode">
        <option value="ãƒãƒ£ãƒ³ã‚¯çµ±åˆ">ãƒãƒ£ãƒ³ã‚¯çµ±åˆ</option>
        <option value="ãƒ•ã‚¡ã‚¤ãƒ«åˆ¥ï¼ˆè¦ç´„+ä¸€è‡´åº¦ï¼‰">ãƒ•ã‚¡ã‚¤ãƒ«åˆ¥ï¼ˆè¦ç´„+ä¸€è‡´åº¦ï¼‰</option>
      </select>
      <label for="model_key" style="margin-left:1em;">åŸ‹ã‚è¾¼ã¿ãƒ¢ãƒ‡ãƒ«ï¼š</label>
      <select id="model_key">
        {% for key, config in embedding_options.items() %}
          <option value="{{ key }}">{{ config["model_name"] }} ({{ config["embedder"] }})</option>
        {% endfor %}
      </select>
    </div>
    <div class="form-actions">
      <button id="search-btn">ğŸ” æ¤œç´¢å®Ÿè¡Œ</button>
      <button id="cancel-btn" disabled>âœ–ï¸ ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <span id="loading">æ¤œç´¢ä¸­â€¦ãŠå¾…ã¡ãã ã•ã„</span>
      <!-- REM: PDFè¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰é¸æŠï¼ˆingestã¨åŒæ§˜ï¼‰ -->
      <span style="margin-left:1em;">
        <label><input type="radio" name="pdf_mode" value="embed" checked> åŒä¸€ã‚¿ãƒ–å†…è¡¨ç¤º</label>
        <label style="margin-left:0.5em;"><input type="radio" name="pdf_mode" value="newtab"> åˆ¥ã‚¿ãƒ–è¡¨ç¤º</label>
      </span>
    </div>
  </div>

  <!-- ä¸‹ãƒšã‚¤ãƒ³ï¼šæ¤œç´¢çµæœã¨å³ãƒšã‚¤ãƒ³ -->
  <div id="pane-bottom">
    <div id="results-pane">
      <div id="answer"></div>
      <div id="results"></div>
    </div>

    <!-- REM: çµæœãƒšã‚¤ãƒ³ã¨å³ãƒšã‚¤ãƒ³ã®é–“ã«å¯å¤‰ã‚¹ãƒ—ãƒªãƒƒã‚¿ãƒ¼ -->
    <div id="splitter"></div>
    <div id="right-pane">
      <!-- PDFè¡¨ç¤ºã¾ãŸã¯ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç·¨é›†ã‚¨ãƒªã‚¢ -->
      <iframe id="pdf-viewer" style="width:100%; height:100%; border:none; display:none;"></iframe>
      <div id="prompt-editor-area" style="display:none; height:100%;">
        <textarea id="prompt-editor" style="width:100%; height:100%; border:none; padding:1em; box-sizing:border-box; resize:none;"></textarea>
      </div>
    </div>
  </div>
</div>

<div id="processing-overlay">
  <div id="overlay-message">å†ãƒ™ã‚¯ãƒˆãƒ«åŒ–ä¸­â€¦<br>é–‰ã˜ãªã„ã§ãã ã•ã„</div>
  <button id="overlay-ok-btn" style="display:none;">OK</button>
</div>

<div id="search-overlay">
  <div class="spinner"></div>
  <div id="search-message">æ¤œç´¢ä¸­â€¦ãŠå¾…ã¡ãã ã•ã„</div>
</div>
{% endblock %}
