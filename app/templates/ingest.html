<!-- app/templates/ingest.html @æ›´æ–°æ—¥æ™‚: 2025-07-18 17:00 JST -->
{% extends "base.html" %}
{% block content %}

<style>
  /* ãƒšã‚¤ãƒ³ä¸Šä¸‹åˆ†å‰² */
  #ingest-container { display:flex; flex-direction:column; height:calc(100vh - 2em); }

  /* ä¸Šãƒšã‚¤ãƒ³ */
  #pane-top {
    flex:0 0 auto;
    padding:1em;
    border-bottom:1px solid #ddd;
    box-sizing:border-box;
  }

  /* ä¸‹ãƒšã‚¤ãƒ³ï¼šãƒ­ã‚°ã¨ç·¨é›†ãƒšã‚¤ãƒ³ã‚’å·¦å³ä¸¦ã³ã« */
  #pane-bottom {
    flex:1 1 auto;
    display:flex;
    overflow:hidden;
  }
  /* å·¦ã‚«ãƒ©ãƒ ï¼šãƒ­ã‚° */
  #log-pane {
    flex:1 1 auto;
    overflow-y:auto;
    padding:1em;
    background:#fafafa;
    box-sizing:border-box;
  }

  /* REM: ãƒšã‚¤ãƒ³é–“ã‚¹ãƒ—ãƒªãƒƒã‚¿ãƒ¼ */
  #splitter {
    flex: 0 0 5px;
    cursor: col-resize;
    background: #ccc;
  }

  /* å³ã‚«ãƒ©ãƒ ï¼šç·¨é›†ã‚¨ãƒªã‚¢ */
  #editor-pane {
    flex:0 0 40%;
    display:none;
    border-left:1px solid #ccc;
    box-sizing:border-box;
    overflow:hidden;
  }
  #editor-pane textarea {
    width:100%; height:100%; border:none;
    padding:1em; box-sizing:border-box;
    resize:none; overflow:auto;
  }

  /* ãƒ•ã‚©ãƒ¼ãƒ  */
  #ingest-form { display:block; width:100%; }
  .form-section {
    display:flex; align-items:center;
    margin-bottom:0.1em; line-height:1.2; width:100%;
  }
  /* REM: è³ªã‚¹ã‚³ã‚¢é–¾å€¤å…¥åŠ›ã‚’ä¸­å¤®å¯„ã› */
  #quality_threshold { text-align: center; }
  .form-actions { margin-top:1em; }
  .form-actions button { margin-right:1em; }

  /* ãƒ­ã‚°è¡¨ç¤º */
  .file-header   { background:#eef; padding:4px 8px; font-weight:bold; margin-top:1em; }
  .file-progress { font-size:0.9em; color:#555; margin-left:1ch; }
  .page-header   { margin-left:1ch; font-style:italic; }
  .file-section  { margin-left:1em; margin-bottom:1em; }
  .file-section pre { white-space:pre-wrap; word-break:break-word; background:#fff; padding:8px; border:1px solid #ddd; }
</style>

<div id="ingest-container">
  <!-- ä¸Šãƒšã‚¤ãƒ³ -->
  <div id="pane-top">
    <h1 class="page-title">âœï¸ ãƒ‡ãƒ¼ã‚¿æ•´å½¢/ç™»éŒ²ï¼ˆLLM ãƒ¢ãƒ‡ãƒ«ï¼š{{ llm_model }}ï¼‰</h1>
    <form id="ingest-form">
      <div class="form-section">
        {% include "partials/ingest/ingest_header.html" %}
      </div>
      <div class="form-section">
        <label for="refine-prompt">ğŸ“ æ•´å½¢ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼š</label>
        <select id="refine-prompt" name="refine_prompt_key">
          {% for key in prompt_keys %}
            <option value="{{ key }}">{{ key }}</option>
          {% endfor %}
        </select>
        <button type="button" id="prompt-edit-btn">ç¢ºèª</button>
      </div>
      <!-- çœç•¥ï¼šåŸ‹ã‚è¾¼ã¿ãƒ¢ãƒ‡ãƒ«ãƒ»ä¸Šæ›¸ããƒ»ãƒœã‚¿ãƒ³ç¾¤ -->
      <div class="form-section">
        <label>ğŸ“ åŸ‹ã‚è¾¼ã¿ãƒ¢ãƒ‡ãƒ«ï¼š</label>
        {% for key, opt in embedding_options.items() %}
          <label style="margin-left:0.5em;">
            <input type="checkbox" name="embed_models" value="{{ key }}" checked>
            {{ loop.index }}. {{ opt.model_name }}
          </label>
        {% endfor %}
      </div>
      <div class="form-section">
        <label for="overwrite_existing">æ—¢å­˜ãƒ¬ã‚³ãƒ¼ãƒ‰ä¸Šæ›¸ãï¼š</label>
        <input id="overwrite_existing" type="checkbox" name="overwrite_existing" value="true">
        <label for="quality_threshold">ï¼ˆè³ªã‚¹ã‚³ã‚¢é–¾å€¤</label>
        <input id="quality_threshold" type="number" name="quality_threshold" min="0" max="1" step="0.05" value="0.0" style="width:4em;">
        <label>ä»¥ä¸Šã¯SKIPï¼‰</label>
      </div>
      <div class="form-actions">
        <button type="button" id="start-btn">ğŸš€ å‡¦ç†é–‹å§‹</button>
        <button type="button" id="cancel-btn" disabled>âœ–ï¸ ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <!-- REM: PDFè¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰é¸æŠ -->
        <span style="margin-left:1em;">
          <label><input type="radio" name="pdf_mode" value="embed" checked> åŒä¸€ã‚¿ãƒ–å†…è¡¨ç¤º</label>
          <label style="margin-left:0.5em;"><input type="radio" name="pdf_mode" value="newtab"> åˆ¥ã‚¿ãƒ–è¡¨ç¤º</label>
        </span>
      </div>
    </form>
  </div>

  <!-- ä¸‹ãƒšã‚¤ãƒ³ï¼šãƒ­ã‚° and ç·¨é›† -->
  <div id="pane-bottom">
    <div id="log-pane"></div>

    <!-- REM: ãƒ­ã‚°ãƒšã‚¤ãƒ³ã¨ç·¨é›†ãƒšã‚¤ãƒ³ã®é–“ã«å¯å¤‰ã‚¹ãƒ—ãƒªãƒƒã‚¿ãƒ¼ -->
    <div id="splitter"></div>
    <div id="editor-pane">
      <textarea id="prompt-editor"></textarea>
    </div>
  </div>
</div>

<script src="{{ url_for('static', path='js/ingest.js') }}"></script>
<script src="{{ url_for('static', path='js/ingest_sse.js') }}"></script>

<!-- REM: PDFãƒªãƒ³ã‚¯ç”¨ã‚¯ãƒ©ã‚¹ä»˜ä¸ã®ä¾‹ -->
<!-- <a href="***/file.pdf" class="pdf-link" target="_blank">file.pdf</a> -->

{% endblock %}
