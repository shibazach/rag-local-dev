{# app/fastapi/templates/ingest.html (æ›´æ–°æ—¥æ™‚: 2025-07-16) #}
{% extends "base.html" %}
{% block content %}

<style>
  /* ãƒšã‚¤ãƒ³ä¸Šä¸‹åˆ†å‰² */
  #ingest-container { display:flex; flex-direction:column; height:calc(100vh - 2em); }
  #pane-top         { flex:0 0 auto; padding:1em; border-bottom:1px solid #ddd; }
  #pane-bottom      { flex:1 1 auto; overflow-y:auto; padding:1em; background:#fafafa; }

  /* ãƒ•ã‚©ãƒ¼ãƒ  */
  .form-section { margin-bottom:1em; }
  .form-actions { margin-top:1em; }
  .form-actions button { margin-right:1em; }

  /* ãƒ­ã‚°è¡¨ç¤º */
  .file-header   { background:#eef; padding:4px 8px; font-weight:bold; margin-top:1em; }
  .file-progress { font-size:0.9em; color:#555; margin-left:1ch; }
  .page-header   { margin-left:1ch; font-style:italic; }
  .file-section  { margin-left:1em; margin-bottom:1em; }
  .file-section pre { white-space:pre-wrap; word-break:break-word; background:#fff; padding:8px; border:1px solid #ddd; }
</style>

<div id="ingest-container">
  <div id="pane-top">
    <h1 class="page-title">âœï¸ ãƒ‡ãƒ¼ã‚¿æ•´å½¢ï¼ç™»éŒ²ï¼ˆç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰ï¼‰</h1>
    <form id="ingest-form">
      <!-- Ollamaãƒ¢ãƒ‡ãƒ«è¡¨ç¤º -->
      <div class="form-section">
        <label>ğŸ–¥ï¸ LLM ãƒ¢ãƒ‡ãƒ«ï¼š</label>
        <span style="font-weight:bold;">{{ llm_model }}</span>
      </div>

      <!-- ãƒ•ã‚©ãƒ«ãƒ€ï¼ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ å…±é€šãƒ‘ãƒ¼ã‚·ãƒ£ãƒ« -->
      <div class="form-section">
        {% include "partials/ingest/ingest_header.html" %}
        {% include "partials/ingest/folder_modal.html" %}
      </div>

      <!-- æ•´å½¢ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ -->
      <div class="form-section">
        <label for="refine-prompt">ğŸ“ æ•´å½¢ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼š</label>
        <select id="refine-prompt" name="refine_prompt_key">
          {% for key in prompt_keys %}
            <option value="{{ key }}">{{ key }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- åŸ‹ã‚è¾¼ã¿ãƒ¢ãƒ‡ãƒ« -->
      <div class="form-section">
        <label>ğŸ“ åŸ‹ã‚è¾¼ã¿ãƒ¢ãƒ‡ãƒ«ï¼š</label><br>
        {% for key, opt in embedding_options.items() %}
          <label style="margin-right:1em;">
            <input type="checkbox" name="embed_models" value="{{ key }}" checked>
            {{ loop.index }}. {{ opt.model_name }}
          </label>
        {% endfor %}
      </div>

      <!-- ä¸Šæ›¸ãï¼è³ªã‚¹ã‚³ã‚¢ -->
      <div class="form-section">
        <label>ä¸Šæ›¸ã: <input type="checkbox" name="overwrite_existing" value="true"></label>
        <label style="margin-left:1em;">
          è³ªã‚¹ã‚³ã‚¢é–¾å€¤:
          <input type="number" name="quality_threshold" min="0" max="1" step="0.05" value="0.0">
        </label>
      </div>

      <!-- å®Ÿè¡Œï¼ã‚­ãƒ£ãƒ³ã‚»ãƒ« -->
      <div class="form-actions">
        <button type="button" id="start-btn">ğŸš€ å‡¦ç†é–‹å§‹</button>
        <button type="button" id="cancel-btn" disabled>âœ–ï¸ ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      </div>
    </form>
  </div>

  <!-- ãƒ­ã‚°å‡ºåŠ›ã‚¨ãƒªã‚¢ -->
  <div id="pane-bottom"></div>
</div>

<!-- JS: ãƒ•ã‚©ãƒ«ãƒ€é¸æŠï¼‹ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ -->
<script src="{{ url_for('static', path='js/ingest.js') }}"></script>
<!-- JS: SSE å—ä¿¡ï¼†ãƒ­ã‚°æç”» -->
<script src="{{ url_for('static', path='js/ingest_sse.js') }}"></script>

{% endblock %}
