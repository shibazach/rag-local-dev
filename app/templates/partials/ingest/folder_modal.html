<!-- REM: templates/partials/ingest/folder_modal.htmlï¼ˆæ›´æ–°æ—¥æ™‚: 2025-07-13 JSTï¼‰ -->
<div id="folder-overlay"></div>

<div id="folder-dialog" class="modal">
  <header>
    <span>ãƒ•ã‚©ãƒ«ãƒ€ã‚’é¸æŠ</span>
    <button id="close-folder-dialog">&times;</button>
  </header>
  <div class="body">
    <div class="breadcrumbs" id="folder-breadcrumbs">/</div>
    <ul id="folder-list"></ul>
  </div>
  <div class="footer">
    <button id="confirm-folder">âœ… æ±ºå®š</button>
  </div>
</div>

<style>
  /* REM: ãƒ¢ãƒ¼ãƒ€ãƒ«å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
  #folder-overlay {
    display:none; position:fixed; inset:0;
    background:rgba(0,0,0,0.4); z-index:99;
  }
  #folder-dialog {
    display:none; position:fixed;
    top:10%; left:50%; transform:translateX(-50%);
    width:400px; max-height:70vh;
    background:#fff; border-radius:8px;
    box-shadow:0 4px 12px rgba(0,0,0,0.3);
    z-index:100; overflow:hidden;
  }
  #folder-dialog header {
    background:#007acc; color:#fff;
    padding:8px 12px; display:flex;
    justify-content:space-between; align-items:center;
  }
  #folder-dialog .body { padding:8px 12px; overflow-y:auto; max-height:60vh; }
  #folder-dialog .breadcrumbs { font-size:0.9em; color:#555; margin-bottom:4px; }
  #folder-list { list-style:none; padding:0; margin:0; }
  #folder-list li { padding:6px 8px; cursor:pointer; border-radius:4px; }
  #folder-list li:hover { background:#f0f8ff; }
  #folder-dialog .footer { padding:8px 12px; text-align:right; }
</style>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<!-- ã‚¹ã‚¯ãƒªãƒ—ãƒˆâ‘  : ãƒ¢ãƒ¼ãƒ€ãƒ«æœ¬ä½“ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆIIFE ã§ã‚¹ã‚³ãƒ¼ãƒ—ã‚’é–‰ã˜ã‚‹ï¼‰ -->
<script>
(() => {
  const overlay = document.getElementById("folder-overlay");
  const dlg     = document.getElementById("folder-dialog");
  const listEl  = document.getElementById("folder-list");
  const bcEl    = document.getElementById("folder-breadcrumbs");
  const inputEl = document.getElementById("input-folder");
  let currentPath = "";

  /* --- ãƒ•ã‚©ãƒ«ãƒ€ãƒªã‚¹ãƒˆå–å¾— & æç”» --------------------------- */
  async function loadFolders(path) {
    currentPath            = path;
    bcEl.textContent       = '/' + (path || '');
    const res              = await fetch(`/api/list-folders?path=${encodeURIComponent(path || '')}`);
    const { folders = [] } = await res.json();
    listEl.innerHTML       = '';

    /* ä¸Šã¸â€¦ */
    if (currentPath) {
      const up = document.createElement('li');
      up.textContent = 'ğŸ”™ ä¸Šã¸';
      up.onclick     = () => loadFolders(currentPath.split('/').slice(0, -1).join('/'));
      listEl.appendChild(up);
    }
    /* å­ãƒ•ã‚©ãƒ«ãƒ€ä¸€è¦§ */
    folders.forEach(name => {
      const li      = document.createElement('li');
      li.textContent = name;
      li.onclick     = () => loadFolders(currentPath ? `${currentPath}/${name}` : name);
      li.ondblclick  = () => { inputEl.value = currentPath ? `${currentPath}/${name}` : name; closeDialog(); };
      listEl.appendChild(li);
    });
  }

  /* --- ãƒ€ã‚¤ã‚¢ãƒ­ã‚°é–‹é–‰ ------------------------------------- */
  function openDialog()  { overlay.style.display = dlg.style.display = 'block'; loadFolders(''); }
  function closeDialog() { overlay.style.display = dlg.style.display = 'none'; }

  /* --- ãƒœã‚¿ãƒ³ï¼†èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ ------------------------------- */
  document.getElementById("close-folder-dialog").onclick = closeDialog;
  document.getElementById("confirm-folder").onclick      = () => {
    if (currentPath) { inputEl.value = currentPath; closeDialog(); }
  };
  overlay.onclick = closeDialog;

  /* --- ä»–ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‹ã‚‰å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†å…¬é–‹ ---------------- */
  window.openFolderModal = openDialog;
})();
</script>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<!-- ã‚¹ã‚¯ãƒªãƒ—ãƒˆâ‘¡ : ãƒ¡ã‚¤ãƒ³ç”»é¢å´ãƒœã‚¿ãƒ³ã« handler ã‚’ä»˜ä¸ï¼ˆå­˜åœ¨ç¢ºèªä»˜ãï¼‰ -->
<script>
(() => {
  document.addEventListener('DOMContentLoaded', () => {
    const browseBtn = document.getElementById("browse-folder");
    if (browseBtn) browseBtn.onclick = () => window.openFolderModal();
  });
})();
</script>
