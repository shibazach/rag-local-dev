<!-- new/templates/ocr_comparison.html -->
<!-- OCRæ¤œè¨¼ãƒšãƒ¼ã‚¸ -->
{% extends "base_new.html" %}

{% block title %}OCRæ¤œè¨¼{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', path='css/ocr_comparison.css') }}">
{% endblock %}

{% block content %}
<div class="ocr-container">
    <!-- 4ãƒšã‚¤ãƒ³æ§‹æˆã®ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div class="ocr-main-content">
        <!-- å·¦ä¸Šãƒšã‚¤ãƒ³: OCRè¨­å®š -->
        <div class="top-left-pane">
            <div class="panel-header">
                <h3>âš™ï¸ OCRè¨­å®š</h3>
                <div class="header-actions">
                    <button id="file-select-btn" class="btn btn-primary">
                        <span class="btn-icon">ğŸ“</span>
                        ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
                    </button>
                    <button id="start-ocr-btn" class="btn btn-success" disabled>
                        <span class="btn-icon">ğŸš€</span>
                        OCRå®Ÿè¡Œ
                    </button>
                </div>
            </div>
            <div class="panel-content">
                <!-- é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ± -->
                <div class="selected-file-info" id="selected-file-info">
                    <div class="file-info-row">
                        <span class="file-info-label">ãƒ•ã‚¡ã‚¤ãƒ«:</span>
                        <span class="file-info-value" id="selected-file-name">æœªé¸æŠ</span>
                    </div>
                </div>

                <!-- OCRã‚¨ãƒ³ã‚¸ãƒ³é¸æŠ -->
                <div class="setting-group">
                    <label for="ocr-engine-select">ğŸ”§ OCRã‚¨ãƒ³ã‚¸ãƒ³</label>
                    <select id="ocr-engine-select" class="form-select">
                        <option value="">ã‚¨ãƒ³ã‚¸ãƒ³ã‚’é¸æŠ...</option>
                    </select>
                </div>

                <!-- ãƒšãƒ¼ã‚¸è¨­å®šã¨èª¤å­—ä¿®æ­£ï¼ˆã‚³ãƒ³ãƒ‘ã‚¯ãƒˆè¡¨ç¤ºï¼‰ -->
                <div class="setting-group compact-row">
                    <div class="setting-item">
                        <label for="page-number">ğŸ“„ å‡¦ç†ãƒšãƒ¼ã‚¸</label>
                        <input type="number" id="page-number" min="0" value="1" step="1" class="form-input-small">
                        <span class="setting-note">0=å…¨ã¦</span>
                    </div>
                    <div class="setting-item">
                        <label class="checkbox-label">
                            <input type="checkbox" id="use-correction" checked>
                            <span class="checkmark"></span>
                            ğŸ”¤ èª¤å­—ä¿®æ­£
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç¸¦ã®å¢ƒç•Œç·š -->
        <div class="vertical-splitter"></div>

        <!-- å³ä¸Šãƒšã‚¤ãƒ³: ã‚¨ãƒ³ã‚¸ãƒ³è©³ç´°è¨­å®š -->
        <div class="top-right-pane">
            <div class="panel-header">
                <h3>ğŸ”§ è©³ç´°è¨­å®š</h3>
            </div>
            <div class="panel-content">
                <div class="engine-details" id="engine-details">
                    <div class="empty-state">
                        <div class="empty-text">
                            OCRã‚¨ãƒ³ã‚¸ãƒ³ã‚’é¸æŠã™ã‚‹ã¨è©³ç´°è¨­å®šãŒè¡¨ç¤ºã•ã‚Œã¾ã™
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å·¦å´ã®æ¨ªå¢ƒç•Œç·š -->
        <div class="horizontal-splitter-left"></div>

        <!-- å³å´ã®æ¨ªå¢ƒç•Œç·š -->
        <div class="horizontal-splitter-right"></div>

        <!-- å·¦ä¸‹ãƒšã‚¤ãƒ³: OCRçµæœ -->
        <div class="bottom-left-pane">
            <div class="panel-header">
                <h3>ğŸ“‹ OCRçµæœ</h3>
                <div class="result-actions">
                    <button id="export-results" class="btn btn-sm btn-outline" disabled>
                        ğŸ“„ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                    </button>
                    <button id="clear-results" class="btn btn-sm btn-outline" disabled>
                        ğŸ—‘ï¸ ã‚¯ãƒªã‚¢
                    </button>
                </div>
            </div>
            <div class="panel-content">
                <div class="results-container" id="results-container">
                    <div class="empty-state">
                        <div class="empty-text">
                            OCRçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å³ä¸‹ãƒšã‚¤ãƒ³: PDFãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
        <div class="bottom-right-pane">
            <div class="panel-header">
                <h3>ğŸ“„ PDFãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
            </div>
            <div class="panel-content">
                <div class="pdf-preview-container">
                    <iframe id="pdf-preview" src=""></iframe>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚° -->
<div id="file-dialog" class="modal" style="display: none;">
    <div class="modal-overlay"></div>
    <div class="modal-content modal-large">
        <div class="modal-header modal-header-compact">
            <h3>ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ</h3>
            <button class="modal-close" id="file-dialog-close">&times;</button>
        </div>
        <div class="modal-body">
            <!-- ãƒ•ã‚¡ã‚¤ãƒ«æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆãƒ‡ãƒ¼ã‚¿ç™»éŒ²ã¨çµ±ä¸€ï¼‰ -->
            <div class="filter-section">
                <div class="filter-row">
                    <div class="filter-group">
                        <select id="status-filter" class="form-control compact-select">
                            <option value="">ã™ã¹ã¦ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</option>
                            <option value="pending_processing" data-status="æœªå‡¦ç†" selected>æœªå‡¦ç†</option>
                            <option value="processing" data-status="å‡¦ç†ä¸­">å‡¦ç†ä¸­</option>
                            <option value="text_extracted" data-status="æœªæ•´å½¢">æœªæ•´å½¢</option>
                            <option value="text_refined" data-status="æœªãƒ™ã‚¯ãƒˆãƒ«åŒ–">æœªãƒ™ã‚¯ãƒˆãƒ«åŒ–</option>
                            <option value="processed" data-status="å‡¦ç†å®Œäº†">å‡¦ç†å®Œäº†</option>
                            <option value="error" data-status="ã‚¨ãƒ©ãƒ¼">ã‚¨ãƒ©ãƒ¼</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <input type="text" id="file-search" class="form-control compact-input" placeholder="ãƒ•ã‚¡ã‚¤ãƒ«åã§æ¤œç´¢...">
                    </div>
                </div>
            </div>

            <!-- ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆãƒ‡ãƒ¼ã‚¿ç™»éŒ²ã¨çµ±ä¸€ï¼‰ -->
            <div class="file-list-container">
                <table class="file-table">
                    <thead>
                        <tr>
                            <th>ãƒ•ã‚¡ã‚¤ãƒ«å</th>
                            <th>é æ•°</th>
                            <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                            <th>ã‚µã‚¤ã‚º</th>
                        </tr>
                    </thead>
                    <tbody id="file-dialog-list">
                        <tr>
                            <td colspan="4" class="loading-state">
                                <div class="spinner"></div>
                                <span>ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’èª­ã¿è¾¼ã¿ä¸­...</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
                <div class="pagination-container">
                    <div class="pagination-info">
                        <span id="file-count-info">0ä»¶ã®ãƒ•ã‚¡ã‚¤ãƒ«</span>
                        <select id="page-size" class="form-control pagination-select">
                            <option value="50">50ä»¶/ãƒšãƒ¼ã‚¸</option>
                            <option value="100" selected>100ä»¶/ãƒšãƒ¼ã‚¸</option>
                            <option value="200">200ä»¶/ãƒšãƒ¼ã‚¸</option>
                            <option value="500">500ä»¶/ãƒšãƒ¼ã‚¸</option>
                        </select>
                    </div>
                    <div class="pagination-nav">
                        <button id="prev-page" class="btn btn-sm btn-outline" disabled>â—€</button>
                        <span id="page-info">1 / 1</span>
                        <button id="next-page" class="btn btn-sm btn-outline" disabled>â–¶</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="file-dialog-cancel" class="btn btn-secondary">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            <button id="file-dialog-select" class="btn btn-primary" disabled>é¸æŠ</button>
        </div>
    </div>
</div>

<!-- å‡¦ç†ä¸­ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
<div id="processing-overlay" class="processing-overlay" style="display: none;">
    <div class="overlay-content">
        <div class="spinner large"></div>
        <div class="overlay-message">OCRå‡¦ç†ä¸­...</div>
        <div class="overlay-details" id="overlay-details">æº–å‚™ä¸­...</div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- OCRæ¤œè¨¼æ©Ÿèƒ½ -->
<script src="{{ url_for('static', path='/js/ocr_comparison.js') }}?v=2" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆ
    document.getElementById('file-select-btn').addEventListener('click', function() {
        document.getElementById('file-dialog').style.display = 'flex';
        // ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’èª­ã¿è¾¼ã¿
        window.ocrManager.loadFileList();
        console.log('[OCR] ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º');
    });

    // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³
    document.getElementById('file-dialog-close').addEventListener('click', function() {
        document.getElementById('file-dialog').style.display = 'none';
    });

    document.getElementById('file-dialog-cancel').addEventListener('click', function() {
        document.getElementById('file-dialog').style.display = 'none';
    });

    // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠå®Œäº†ãƒœã‚¿ãƒ³
    document.getElementById('file-dialog-select').addEventListener('click', function() {
        if (window.ocrManager.selectedFileId && window.ocrManager.selectedFileInfo) {
            window.ocrManager.selectFile(window.ocrManager.selectedFileId, window.ocrManager.selectedFileInfo.file_name);
        }
    });

    // OCRå®Ÿè¡Œãƒœã‚¿ãƒ³
    document.getElementById('start-ocr-btn').addEventListener('click', function() {
        console.log('[OCR] OCRå®Ÿè¡Œé–‹å§‹');
        // OCRå‡¦ç†ã®ã‚¹ã‚¿ãƒ–
    });

    console.log('[OCR] OCRæ¤œè¨¼ãƒšãƒ¼ã‚¸ãŒåˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ');
});
</script>
{% endblock %}