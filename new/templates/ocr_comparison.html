<!-- new/templates/ocr_comparison.html -->
<!-- OCR検証ページ -->
{% extends "base_new.html" %}

{% block title %}OCR検証{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', path='css/ocr_comparison.css') }}">
{% endblock %}

{% block content %}
<div class="ocr-container">
    <!-- 4ペイン構成のメインコンテンツ -->
    <div class="ocr-main-content">
        <!-- 左上ペイン: OCR設定 -->
        <div class="top-left-pane">
            <div class="panel-header">
                <h3>⚙️ OCR設定</h3>
                <div class="header-actions">
                    <button id="file-select-btn" class="btn btn-primary">
                        <span class="btn-icon">📁</span>
                        ファイル選択
                    </button>
                    <button id="start-ocr-btn" class="btn btn-success" disabled>
                        <span class="btn-icon">🚀</span>
                        OCR実行
                    </button>
                </div>
            </div>
            <div class="panel-content">
                <!-- 選択されたファイル情報 -->
                <div class="selected-file-info" id="selected-file-info">
                    <div class="file-info-row">
                        <span class="file-info-label">ファイル:</span>
                        <span class="file-info-value" id="selected-file-name">未選択</span>
                    </div>
                </div>

                <!-- OCRエンジン選択 -->
                <div class="setting-group">
                    <label for="ocr-engine-select">🔧 OCRエンジン</label>
                    <select id="ocr-engine-select" class="form-select">
                        <option value="">エンジンを選択...</option>
                    </select>
                </div>

                <!-- ページ設定と誤字修正（コンパクト表示） -->
                <div class="setting-group compact-row">
                    <div class="setting-item">
                        <label for="page-number">📄 処理ページ</label>
                        <input type="number" id="page-number" min="0" value="1" step="1" class="form-input-small">
                        <span class="setting-note">0=全て</span>
                    </div>
                    <div class="setting-item">
                        <label class="checkbox-label">
                            <input type="checkbox" id="use-correction" checked>
                            <span class="checkmark"></span>
                            🔤 誤字修正
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- 縦の境界線 -->
        <div class="vertical-splitter"></div>

        <!-- 右上ペイン: エンジン詳細設定 -->
        <div class="top-right-pane">
            <div class="panel-header">
                <h3>🔧 詳細設定</h3>
            </div>
            <div class="panel-content">
                <div class="engine-details" id="engine-details">
                    <div class="empty-state">
                        <div class="empty-text">
                            OCRエンジンを選択すると詳細設定が表示されます
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 左側の横境界線 -->
        <div class="horizontal-splitter-left"></div>

        <!-- 右側の横境界線 -->
        <div class="horizontal-splitter-right"></div>

        <!-- 左下ペイン: OCR結果 -->
        <div class="bottom-left-pane">
            <div class="panel-header">
                <h3>📋 OCR結果</h3>
                <div class="result-actions">
                    <button id="export-results" class="btn btn-sm btn-outline" disabled>
                        📄 エクスポート
                    </button>
                    <button id="clear-results" class="btn btn-sm btn-outline" disabled>
                        🗑️ クリア
                    </button>
                </div>
            </div>
            <div class="panel-content">
                <div class="results-container" id="results-container">
                    <div class="empty-state">
                        <div class="empty-text">
                            OCR結果がここに表示されます
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 右下ペイン: PDFプレビュー -->
        <div class="bottom-right-pane">
            <div class="panel-header">
                <h3>📄 PDFプレビュー</h3>
            </div>
            <div class="panel-content">
                <div class="pdf-preview-container">
                    <iframe id="pdf-preview" src=""></iframe>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ファイル選択ダイアログ -->
<div id="file-dialog" class="modal" style="display: none;">
    <div class="modal-overlay"></div>
    <div class="modal-content modal-large">
        <div class="modal-header modal-header-compact">
            <h3>📁 ファイル選択</h3>
            <button class="modal-close" id="file-dialog-close">&times;</button>
        </div>
        <div class="modal-body">
            <!-- ファイル検索・フィルター（データ登録と統一） -->
            <div class="filter-section">
                <div class="filter-row">
                    <div class="filter-group">
                        <select id="status-filter" class="form-control compact-select">
                            <option value="">すべてのステータス</option>
                            <option value="pending_processing" data-status="未処理" selected>未処理</option>
                            <option value="processing" data-status="処理中">処理中</option>
                            <option value="text_extracted" data-status="未整形">未整形</option>
                            <option value="text_refined" data-status="未ベクトル化">未ベクトル化</option>
                            <option value="processed" data-status="処理完了">処理完了</option>
                            <option value="error" data-status="エラー">エラー</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <input type="text" id="file-search" class="form-control compact-input" placeholder="ファイル名で検索...">
                    </div>
                </div>
            </div>

            <!-- ファイル一覧テーブル（データ登録と統一） -->
            <div class="file-list-container">
                <table class="file-table">
                    <thead>
                        <tr>
                            <th>ファイル名</th>
                            <th>頁数</th>
                            <th>ステータス</th>
                            <th>サイズ</th>
                        </tr>
                    </thead>
                    <tbody id="file-dialog-list">
                        <tr>
                            <td colspan="4" class="loading-state">
                                <div class="spinner"></div>
                                <span>ファイル一覧を読み込み中...</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <!-- ページネーション -->
                <div class="pagination-container">
                    <div class="pagination-info">
                        <span id="file-count-info">0件のファイル</span>
                        <select id="page-size" class="form-control pagination-select">
                            <option value="50">50件/ページ</option>
                            <option value="100" selected>100件/ページ</option>
                            <option value="200">200件/ページ</option>
                            <option value="500">500件/ページ</option>
                        </select>
                    </div>
                    <div class="pagination-nav">
                        <button id="prev-page" class="btn btn-sm btn-outline" disabled>◀</button>
                        <span id="page-info">1 / 1</span>
                        <button id="next-page" class="btn btn-sm btn-outline" disabled>▶</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="file-dialog-cancel" class="btn btn-secondary">キャンセル</button>
            <button id="file-dialog-select" class="btn btn-primary" disabled>選択</button>
        </div>
    </div>
</div>

<!-- 処理中オーバーレイ -->
<div id="processing-overlay" class="processing-overlay" style="display: none;">
    <div class="overlay-content">
        <div class="spinner large"></div>
        <div class="overlay-message">OCR処理中...</div>
        <div class="overlay-details" id="overlay-details">準備中...</div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- OCR検証機能 -->
<script src="{{ url_for('static', path='/js/ocr_comparison.js') }}?v=2" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // ファイル選択ボタンのイベント
    document.getElementById('file-select-btn').addEventListener('click', function() {
        document.getElementById('file-dialog').style.display = 'flex';
        // ファイル一覧を読み込み
        window.ocrManager.loadFileList();
        console.log('[OCR] ファイル選択ダイアログを表示');
    });

    // ダイアログの閉じるボタン
    document.getElementById('file-dialog-close').addEventListener('click', function() {
        document.getElementById('file-dialog').style.display = 'none';
    });

    document.getElementById('file-dialog-cancel').addEventListener('click', function() {
        document.getElementById('file-dialog').style.display = 'none';
    });

    // ファイル選択完了ボタン
    document.getElementById('file-dialog-select').addEventListener('click', function() {
        if (window.ocrManager.selectedFileId && window.ocrManager.selectedFileInfo) {
            window.ocrManager.selectFile(window.ocrManager.selectedFileId, window.ocrManager.selectedFileInfo.file_name);
        }
    });

    // OCR実行ボタン
    document.getElementById('start-ocr-btn').addEventListener('click', function() {
        console.log('[OCR] OCR実行開始');
        // OCR処理のスタブ
    });

    console.log('[OCR] OCR検証ページが初期化されました');
});
</script>
{% endblock %}